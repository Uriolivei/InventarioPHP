"use strict";
!function() {
    var e = {
        red: "#f44336",
        lightBlue: "#03a9f4",
        orange: "#ffc107",
        amber: "#ff9800",
        teal: "#00bcd4",
        purple: "#7726d3",
        green: "#00d45a",
        rowBgColor: "#4a4a4a"
    };
    
    document.addEventListener("DOMContentLoaded", function() {
        var n = d3.select(".pie-chart__container");

        // Verificamos si el contenedor existe antes de crear el gráfico
        n[0][0] && !function() {
            // Colores y datos de la gráfica
            var n = [e.lightBlue, e.red, e.amber, e.green, e.teal];
            var t = [
                { key: "Compras", y: 30 },
                { key: "Ventas", y: 25 },
                { key: "Usuarios Registrados", y: 20 },
                { key: "Productos", y: 15 },
                { key: "Otros", y: 10 }
            ];

            nv.addGraph(function() {
                var r = .86,
                    a = 1.02,
                    i = nv.models.pieChart()
                        .x(function(e) { return e.key })
                        .y(function(e) { return e.y })
                        .showLabels(false)
                        .donut(true)
                        .growOnHover(true)
                        .padAngle(.04)
                        .cornerRadius(0)
                        .margin({ left: -10, right: -10, top: -10, bottom: -10 })
                        .color(n)
                        .arcsRadius([{ inner: r, outer: a }, { inner: r, outer: a }, { inner: r, outer: a }, { inner: r, outer: a }, { inner: r, outer: a }])
                        .showLegend(false)
                        .title("")
                        .titleOffset(10);

                i.tooltip.enabled(true).hideDelay(0).headerEnabled(false).contentGenerator(function(e) {
                    return null === e ? "" : (d3.selectAll(".nvtooltip").classed("mdl-tooltip", true), e.data.y + " ventas");
                });

                // Renderizamos el gráfico de pastel en el contenedor seleccionado
                var svg = d3.select(".pie-chart__container").append("div").append("svg").attr("width", 300).attr("height", 300);
                svg.datum(t).transition().duration(1200).call(i);

                // Añadimos imagen al centro del gráfico
                svg.append("svg:image")
                    .attr("xlink:href", "vistas/img/ventas.png") // Ruta de la imagen
                    .attr("width", 50)  // Ancho de la imagen
                    .attr("height", 50) // Alto de la imagen
                    .attr("x", svg.attr("width") / 2 - 80)     // Posición en X (centrado)
                    .attr("y", svg.attr("height") / 2 - 70);    // Posición en Y (centrado)

                // Añadimos leyenda de colores
                var c = d3.scale.ordinal().range(n),
                    s = d3.select(".pie-chart__container").append("div").attr("class", "legend").selectAll(".legend__item").data(t).enter().append("div").attr("class", "legend__item");

                s.append("div").attr("class", "legend__mark pull-left").style("background-color", function(e) { return c(e.key) });
                s.append("div").attr("class", "legend__text").text(function(e) { return e.key });

                return i;
            });
        }();
    });
}();
